<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirim Pesan - Nanda Teknik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; background-color: #f9fafb; }</style>
</head>
<body class="p-6">
    <div class="max-w-md mx-auto">
        <div class="flex items-center gap-4 mb-8">
            <a href="dashboard.html" class="p-3 bg-white shadow-sm rounded-2xl text-gray-900 border border-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </a>
            <h1 class="text-2xl font-black text-gray-900 tracking-tighter">Kirim Pesan</h1>
        </div>

        <form id="emailForm" class="space-y-5">
            <div class="bg-white p-6 rounded-[2.5rem] shadow-xl shadow-gray-200/50 border border-gray-100 space-y-4">
                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-2 block mb-2">Email Pelanggan</label>
                    <input type="email" id="penerima" required placeholder="customer@mail.com" class="w-full bg-gray-50 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500 font-bold text-sm transition-all">
                </div>
                
                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-2 block mb-2">Subjek</label>
                    <input type="text" id="subjek" required placeholder="Info Perbaikan / Invoice" class="w-full bg-gray-50 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500 font-bold text-sm transition-all">
                </div>

                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-2 block mb-2">Isi Pesan</label>
                    <textarea id="pesan" rows="5" required placeholder="Halo, unit Anda sudah selesai..." class="w-full bg-gray-50 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500 font-medium text-sm transition-all"></textarea>
                </div>

                <div>
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] ml-2 block mb-2">Lampiran (Foto/PDF)</label>
                    <input type="file" id="lampiran" class="hidden" onchange="showName()">
                    <label for="lampiran" class="w-full border-2 border-dashed border-gray-200 p-4 rounded-2xl flex flex-col items-center justify-center gap-2 cursor-pointer hover:bg-gray-50 transition-all">
                        <svg class="w-6 h-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        <span id="fileName" class="text-[11px] font-bold text-gray-400 uppercase">Pilih File...</span>
                    </label>
                </div>
            </div>

            <button type="submit" id="btnSubmit" class="w-full bg-gray-900 text-white py-5 rounded-[2rem] font-black text-xs uppercase tracking-[0.2em] shadow-2xl active:scale-95 transition-all">
                Kirim Email Sekarang
            </button>
        </form>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwLkx1H8hTDGlXbokOziXL8kZQg1gXuyTIoW18wSLu3Vj5PF1J-x1AL-GnyRYuRcVziDw/exec";

        function showName() {
            const input = document.getElementById('lampiran');
            document.getElementById('fileName').innerText = input.files[0].name;
            document.getElementById('fileName').classList.replace('text-gray-400', 'text-blue-600');
        }

        document.getElementById('emailForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            const fileInput = document.getElementById('lampiran');
            
            btn.disabled = true;
            btn.innerHTML = "MEMPROSES DATA...";

            let fileData = null;

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                fileData = await new Promise((resolve) => {
                    reader.onload = (e) => resolve({
                        base64: e.target.result.split(',')[1],
                        name: file.name,
                        type: file.type
                    });
                    reader.readAsDataURL(file);
                });
            }

            const payload = {
                action: "kirimEmail",
                penerima: document.getElementById('penerima').value,
                subjek: document.getElementById('subjek').value,
                pesan: document.getElementById('pesan').value,
                file: fileData
            };

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if(result.result === "success") {
                    alert("Email Terkirim!");
                    document.getElementById('emailForm').reset();
                    document.getElementById('fileName').innerText = "Pilih File...";
                }
            } catch (err) {
                alert("Error: " + err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = "Kirim Email Sekarang";
            }
        };
    </script>
</body>
</html>
