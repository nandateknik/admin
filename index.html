<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Nanda Teknik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 pb-24">

    <header class="bg-blue-600 text-white p-4 sticky top-0 z-50 shadow-lg rounded-b-2xl">
        <div class="flex justify-between items-center max-w-md mx-auto">
            <div>
                <p class="text-xs opacity-80" id="todayDate">Rabu, 11 Feb 2026</p>
                <h1 class="font-bold text-xl" id="welcomeUser">Halo, Teknisi!</h1>
            </div>
            <button onclick="logout()" class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center hover:bg-red-500 transition">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">
        
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                <div class="text-blue-500 mb-2"><i class="fas fa-wallet text-xl"></i></div>
                <p class="text-xs text-gray-500">Saldo System</p>
                <h3 id="txtSaldo" class="font-bold text-lg text-gray-800">Rp --</h3>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
                <div class="text-orange-500 mb-2"><i class="fas fa-tasks text-xl"></i></div>
                <p class="text-xs text-gray-500">Antrian Kerja</p>
                <h3 id="txtWorkload" class="font-bold text-lg text-gray-800">--</h3>
            </div>
        </div>

        <div>
            <h2 class="font-bold text-gray-700 mb-3">Menu Cepat</h2>
            <div class="grid grid-cols-4 gap-2">
                <button onclick="Swal.fire('Fitur Segera Datang','Tambah Booking Baru','info')" class="bg-white p-3 rounded-xl shadow-sm text-center">
                    <i class="fas fa-plus-circle text-blue-600 mb-1 block"></i><span class="text-[10px]">Booking</span>
                </button>
                <button onclick="Swal.fire('Fitur Segera Datang','Input Pengeluaran','info')" class="bg-white p-3 rounded-xl shadow-sm text-center">
                    <i class="fas fa-receipt text-red-500 mb-1 block"></i><span class="text-[10px]">Keluar</span>
                </button>
                <button onclick="loadData()" class="bg-white p-3 rounded-xl shadow-sm text-center">
                    <i class="fas fa-sync text-green-500 mb-1 block"></i><span class="text-[10px]">Refresh</span>
                </button>
                <button onclick="Swal.fire('Fitur Segera Datang','Catatan Pribadi','info')" class="bg-white p-3 rounded-xl shadow-sm text-center">
                    <i class="fas fa-sticky-note text-yellow-500 mb-1 block"></i><span class="text-[10px]">Memo</span>
                </button>
            </div>
        </div>

        <div>
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-bold text-gray-700">Pekerjaan Aktif</h2>
                <span class="text-[10px] text-blue-600 font-bold">LIVE UPDATE</span>
            </div>
            <div id="jobContainer" class="space-y-3">
                <div class="bg-gray-200 animate-pulse h-20 rounded-xl"></div>
                <div class="bg-gray-200 animate-pulse h-20 rounded-xl"></div>
            </div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-gray-100 flex justify-around py-3 px-2 z-50">
        <button class="flex flex-col items-center text-blue-600">
            <i class="fas fa-home text-lg"></i><span class="text-[10px] mt-1">Beranda</span>
        </button>
        <button onclick="Swal.fire('Segera','Menu Jadwal','info')" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-calendar-check text-lg"></i><span class="text-[10px] mt-1">Jadwal</span>
        </button>
        <button onclick="Swal.fire('Segera','Menu Keuangan','info')" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-chart-line text-lg"></i><span class="text-[10px] mt-1">Laporan</span>
        </button>
        <button onclick="Swal.fire('Segera','Menu Pelanggan','info')" class="flex flex-col items-center text-gray-400">
            <i class="fas fa-users text-lg"></i><span class="text-[10px] mt-1">Customer</span>
        </button>
    </nav>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzL-SgC...your_id.../exec";
        
        // 1. Validasi Login
        const userData = JSON.parse(localStorage.getItem("user_nanda"));
        if (!userData) {
            window.location.href = "login.html";
        } else {
            document.getElementById('welcomeUser').innerText = "Halo, " + userData.nama.split(' ')[0] + "!";
        }

        // 2. Load Data dari Apps Script
        async function loadData() {
            try {
                // Ambil Data Keuangan
                const resKeuangan = await fetch(API_URL + "?type=rekap_keuangan");
                const dataKeuangan = await resKeuangan.json();
                document.getElementById('txtSaldo').innerText = "Rp " + dataKeuangan.saldo.toLocaleString('id-ID');

                // Ambil Data Workload (Default doGet)
                const resWork = await fetch(API_URL);
                const dataWork = await resWork.json();
                
                document.getElementById('txtWorkload').innerText = dataWork.length + " Task";
                
                let html = "";
                if (dataWork.length === 0) {
                    html = `<p class="text-center text-gray-400 text-sm py-10">Tidak ada pekerjaan aktif.</p>`;
                } else {
                    dataWork.forEach(job => {
                        html += `
                        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center group active:bg-gray-50 transition">
                            <div class="flex-1">
                                <h4 class="font-bold text-gray-800 text-sm">${job.nama}</h4>
                                <p class="text-xs text-gray-500">${job.pekerjaan}</p>
                                <p class="text-[10px] text-blue-500 mt-1"><i class="far fa-clock mr-1"></i>${job.tanggal}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-block px-2 py-1 rounded-lg text-[9px] font-bold bg-blue-100 text-blue-700 uppercase tracking-wider">${job.status}</span>
                                <i class="fas fa-chevron-right text-gray-300 ml-2 text-xs"></i>
                            </div>
                        </div>`;
                    });
                }
                document.getElementById('jobContainer').innerHTML = html;

            } catch (e) {
                Swal.fire({ icon: 'error', title: 'Data Error', text: 'Gagal memuat data dari spreadsheet.' });
            }
        }

        function logout() {
            Swal.fire({
                title: 'Logout?',
                text: "Anda harus login kembali nanti.",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ya, Keluar'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear();
                    window.location.href = "login.html";
                }
            })
        }

        // Jalankan saat startup
        window.onload = loadData;
        document.getElementById('todayDate').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    </script>
</body>
</html>
